<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Architecture Projet Turtle</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .architecture-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .module {
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 20px;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .module.hardware { border-color: #e74c3c; background: linear-gradient(145deg, #ffeaa7, #fab1a0); }
        .module.control { border-color: #9b59b6; background: linear-gradient(145deg, #a29bfe, #6c5ce7); color: white; }
        .module.interface { border-color: #2ecc71; background: linear-gradient(145deg, #00b894, #00cec9); color: white; }
        .module.data { border-color: #f39c12; background: linear-gradient(145deg, #fdcb6e, #e17055); }
        .module.sensors { border-color: #1abc9c; background: linear-gradient(145deg, #74b9ff, #0984e3); color: white; }
        
        .module h3 {
            margin: 0 0 15px 0;
            font-size: 1.3em;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 8px;
        }
        
        .function-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .function-list li {
            background: rgba(255,255,255,0.2);
            margin: 5px 0;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }
        
        .function-list li:hover {
            background: rgba(255,255,255,0.4);
            transform: translateX(5px);
        }
        
        .flow-diagram {
            background: #2c3e50;
            border-radius: 10px;
            padding: 30px;
            margin-top: 30px;
            color: white;
        }
        
        .flow-title {
            text-align: center;
            font-size: 1.8em;
            margin-bottom: 25px;
            color: #ecf0f1;
        }
        
        .flow-steps {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            align-items: center;
        }
        
        .flow-step {
            background: linear-gradient(145deg, #3498db, #2980b9);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .flow-step::after {
            content: '‚Üí';
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 1.5em;
            color: #ecf0f1;
        }
        
        .flow-step:last-child::after {
            display: none;
        }
        
        .critical-functions {
            background: #e74c3c;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            color: white;
        }
        
        .critical-title {
            font-size: 1.4em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .critical-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }
        
        .critical-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #fff;
        }
        
        .legend {
            background: #34495e;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            color: white;
        }
        
        .legend-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üê¢ Architecture Projet Turtle - Robot Tondeuse</h1>
        
        <div class="architecture-grid">
            <!-- Module Hardware -->
            <div class="module hardware">
                <h3>üîß Hardware (stepper_motor_class.py)</h3>
                <ul class="function-list">
                    <li>__init__() - Initialisation moteur pigpio</li>
                    <li>set_dir() - Direction forward/backward</li>
                    <li>enable()/disable() - Activation moteur</li>
                    <li>set_speed() - Contr√¥le vitesse (delay)</li>
                    <li>move_steps() - Mouvement pr√©cis par pas</li>
                    <li>move_continuously() - Mouvement continu</li>
                    <li>stop_moving() - Arr√™t urgence</li>
                    <li>cleanup() - Nettoyage GPIO</li>
                </ul>
            </div>

            <!-- Module Control -->
            <div class="module control">
                <h3>üéÆ Contr√¥le Robot (robot_controller_class.py)</h3>
                <ul class="function-list">
                    <li>__init__() - Setup moteurs gauche/droit</li>
                    <li>move_forward()/move_backward() - Mouvements de base</li>
                    <li>select_type_rotate() - Rotations avec rampe</li>
                    <li>update_speed() - Synchronisation vitesse</li>
                    <li>move_for_distance() - D√©placement pr√©cis (autonome)</li>
                    <li>turn_on_spot_for_angle() - Rotation pr√©cise</li>
                    <li>make_turn() - Virages larges</li>
                    <li>stop()/pause()/resume() - Contr√¥les d'√©tat</li>
                    <li>_calculate_delay() - Conversion vitesse‚Üíd√©lai</li>
                </ul>
            </div>

            <!-- Module Interface Web -->
            <div class="module interface">
                <h3>üåê Interface Web (robot_controller.html)</h3>
                <ul class="function-list">
                    <li>sendCommand() - Communication API</li>
                    <li>drawLivePath() - Visualisation temps r√©el</li>
                    <li>pollLivePath() - Synchronisation serveur</li>
                    <li>closeZoneAutomatically() - Fermeture zone</li>
                    <li>startRealTimeSegmentDisplay() - Affichage direct</li>
                    <li>debugSystem() - Diagnostic client</li>
                    <li>updateUI() - Mise √† jour interface</li>
                    <li>getCurrentPositionFromVectors() - Calcul position</li>
                </ul>
            </div>

            <!-- Module Serveur -->
            <div class="module data">
                <h3>üñ•Ô∏è Serveur Flask (server_for_robot.py)</h3>
                <ul class="function-list">
                    <li>handle_command() - Traitement commandes</li>
                    <li>process_raw_path_to_vectors() - Conversion √©v√©nements</li>
                    <li>merge_vectors() - Fusion vecteurs</li>
                    <li>calculateRealPositionFromVectors() - Position r√©elle</li>
                    <li>get_current_position() - API position</li>
                    <li>generate_mowing_path() - Parcours basique</li>
                    <li>generate_advanced_mowing_path() - Parcours avanc√©</li>
                    <li>run_autonomous_mowing() - Tonte automatique</li>
                </ul>
            </div>

            <!-- Module Base de Donn√©es -->
            <div class="module data">
                <h3>üóÑÔ∏è Base de Donn√©es (database_manager.py)</h3>
                <ul class="function-list">
                    <li>_create_tables() - Cr√©ation sch√©ma BD</li>
                    <li>save_zone() - Sauvegarde p√©rim√®tres</li>
                    <li>get_zone_by_name() - R√©cup√©ration zones</li>
                    <li>get_all_zones() - Liste compl√®te</li>
                    <li>delete_zone() - Suppression unitaire</li>
                    <li>delete_zones_by_ids() - Suppression multiple</li>
                    <li>delete_all_zones() - Suppression totale</li>
                    <li>save_mowing_history() - Historique tontes</li>
                </ul>
            </div>

            <!-- Module Utilitaires -->
            <div class="module control">
                <h3>‚öôÔ∏è Utilitaires (SpeedConverter.py)</h3>
                <ul class="function-list">
                    <li>__init__() - Config moteur/roue</li>
                    <li>convert_kmh_to_steps_per_sec() - Conversion vitesse</li>
                    <li>Calculs g√©om√©triques circonf√®rence</li>
                    <li>Validation seuils vitesse</li>
                </ul>
            </div>

            <!-- Module Capteurs -->
            <div class="module sensors">
                <h3>üì° Capteurs LIDAR (lidar_ld06_manager.py)</h3>
                <ul class="function-list">
                    <li>connect() - Connexion s√©rie LIDAR</li>
                    <li>start_scanning() - D√©marrage acquisition</li>
                    <li>_read_loop() - Lecture continue donn√©es</li>
                    <li>_process_packet() - Traitement paquets LD06</li>
                    <li>get_distance_at_angle() - Distance √† angle donn√©</li>
                    <li>get_front_distance() - Distance frontale</li>
                    <li>_check_obstacles() - D√©tection obstacles</li>
                    <li>set_obstacle_callback() - Callback √©vitement</li>
                </ul>
            </div>

            <!-- Module Test -->
            <div class="module hardware">
                <h3>üîå Test Connexion (esp32_connect_test.py)</h3>
                <ul class="function-list">
                    <li>Serial connection test</li>
                    <li>USB0 port monitoring</li>
                    <li>Data reception loop</li>
                    <li>Baudrate 115200</li>
                </ul>
            </div>
        </div>

        <div class="flow-diagram">
            <div class="flow-title">üîÑ Flux Principal d'Enregistrement de Zone</div>
            <div class="flow-steps">
                <div class="flow-step">Interface Web<br>Bouton Enregistrement</div>
                <div class="flow-step">Serveur Flask<br>start_recording</div>
                <div class="flow-step">Commandes Robot<br>forward/turn_left/etc</div>
                <div class="flow-step">Log √âv√©nements<br>raw_path_log</div>
                <div class="flow-step">Traitement Vecteurs<br>process_raw_path_to_vectors</div>
                <div class="flow-step">Fusion & Calcul<br>merge_vectors</div>
                <div class="flow-step">Sauvegarde BD<br>save_zone</div>
            </div>
        </div>

        <div class="critical-functions">
            <div class="critical-title">üö® Fonctions Critiques Identifi√©es</div>
            <div class="critical-grid">
                <div class="critical-item">
                    <strong>calculateRealPositionFromVectors()</strong><br>
                    Calcul position - Bug rotation corrig√©
                </div>
                <div class="critical-item">
                    <strong>merge_vectors()</strong><br>
                    Fusion vecteurs - Simplification appliqu√©e
                </div>
                <div class="critical-item">
                    <strong>drawLivePath()</strong><br>
                    Affichage temps r√©el - Synchronisation serveur
                </div>
                <div class="critical-item">
                    <strong>closeZoneAutomatically()</strong><br>
                    Fermeture zone - Validation position serveur
                </div>
                <div class="critical-item">
                    <strong>sendCommand()</strong><br>
                    Communication - Gestion tracking temps r√©el
                </div>
                <div class="critical-item">
                    <strong>pollLivePath()</strong><br>
                    Synchronisation - Fr√©quence temps r√©el
                </div>
            </div>
        </div>

        <div class="legend">
            <h3>üìã L√©gende des Modules</h3>
            <div class="legend-grid">
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(145deg, #ffeaa7, #fab1a0);"></div>
                    <span>Hardware - Moteurs & GPIO</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(145deg, #a29bfe, #6c5ce7);"></div>
                    <span>Control - Logique robot</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(145deg, #00b894, #00cec9);"></div>
                    <span>Interface - Web UI</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(145deg, #fdcb6e, #e17055);"></div>
                    <span>Data - Serveur & BD</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: linear-gradient(145deg, #74b9ff, #0984e3);"></div>
                    <span>Sensors - LIDAR</span>
                </div>
            </div>
        </div>

        <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px; border-left: 5px solid #3498db;">
            <h3>üéØ √âtat Actuel du Projet</h3>
            <p><strong>Probl√®me principal r√©solu :</strong> Bug dans calculateRealPositionFromVectors() lors des rotations</p>
            <p><strong>Corrections appliqu√©es :</strong> S√©paration rotations pures vs mouvements, normalisation angles</p>
            <p><strong>Test valid√© :</strong> Distance fermeture zone r√©duite de ~20m √† ~2m</p>
            <p><strong>Prochaine √©tape :</strong> Finaliser synchronisation client-serveur pour affichage temps r√©el</p>
        </div>
    </div>
</body>
</html>